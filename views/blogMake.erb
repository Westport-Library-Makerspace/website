<header class="header-image">
<div class="headline">
  <div class="container">
    <!--<h1>Westport Library Makerspace</h1>
    <h2>Come in, Go far</h2>-->

    <img class="logo" src="/ms_logo_alt_white_w_wl_logo_w_border.png">

  </div>
</div>

</header>
<div class="container">

<form id="blog-make-form" action="<%= @isEdit ? "/blog/edit/#{@blog.id}" : "/blog/new" %>" method="post" class="form-horizontal">
  <div class="control-group">
    <label class="control-label" for="inputTitle">Title</label>

    <div class="controls">
      <input type="text" id="inputTitle" name="title" class="form-control" value="<%= @isEdit ? @blog.title : '' %>" placeholder="Title">
    </div>
  </div>
  <div class="control-group">
    <label class="control-label" for="inputDate">At Date</label>

    <div class="controls">
      <input type="text" class="form-control" id="inputDate" name="date" value="<%= @isEdit ? @blog.date.to_s : Date.today.to_s %>">
      <% #Time here is for display purposes only. The real time is set in the post.  %>
    </div>
  </div>
  <div class="control-group">
    <label class="control-label" for="content">Message</label>
    <div id="toolbar">
      <button class="ql-bold">Bold</button>
      <button class="ql-italic">Italic</button>
    </div>
    <div class="controls">
      <div rows="10" class="form-control" id="content" name="content"><%= @isEdit ? @blog.content : '' %></div>
    </div>
  </div>
  <br/>
</form>

<div class="panel-group" id="accordion">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
          Formatting Help
        </a>
      </h4>
    </div>
    <div id="collapseOne" class="panel-collapse collapse in">
      <div class="panel-body">
      </div>
    </div>
  </div>
</div>
<br/>
<% if @isEdit %>
    <form method="post" action="/blog/del/<%= @blog.id %>">
<% end %>
<div class="control-group">
  <div class="controls">
    <button type="submit" form="blog-make-form" name="draft" class="btn btn-info"><%= (@isEdit && !@blog.draft == 0) ? '<span class="fa fa-eye-slash"></span> Demote to Draft' : '<span class="fa fa-pencil-square-o"></span> Save as Draft' %></button>
    <% if @publishC %>
    <button type="submit" form="blog-make-form" name="publish" class="btn btn-success">
      <span class="fa fa-cloud-upload"></span> Publish Post
    </button>
        <% end %>
    <% if @isEdit && @publishC %>
        <button type="submit" class="btn btn-danger" onclick="return confirm('Delete Post?');"><span class="fa fa-trash"></span>
          Delete Post
        </button>
    <% end %>
  </div>
</div>
<% if @isEdit %>
    </form>
<% end %>
  <script>
    var fullEditor = new Quill('#content', {
      modules: {
        'authorship': { authorId: 'galadriel', enabled: true },
        'multi-cursor': true,
        'toolbar': { container: '#toolbar' },
        'link-tooltip': true
      },
      theme: 'snow'
    });

    // Add basic editor's author
    var authorship = fullEditor.getModule('authorship');
    authorship.addAuthor('gandalf', 'rgba(255,153,51,0.4)');

    // Add a cursor to represent basic editor's cursor
    var cursorManager = fullEditor.getModule('multi-cursor');
    cursorManager.setCursor('gandalf', fullEditor.getLength()-1, 'Gandalf', 'rgba(255,153,51,0.9)');

    // Sync basic editor's cursor location
    basicEditor.on('selection-change', function(range) {
      if (range) {
        cursorManager.moveCursor('gandalf', range.end);
      }
    });

    // Update basic editor's content with ours
    fullEditor.on('text-change', function(delta, source) {
      if (source === 'user') {
        basicEditor.updateContents(delta);
      }
    });

    // basicEditor needs authorship module to accept changes from fullEditor's authorship module
    basicEditor.addModule('authorship', {
      authorId: 'gandalf',
      color: 'rgba(255,153,51,0.4)'
    });

    // Update our content with basic editor's
    basicEditor.on('text-change', function(delta, source) {
      if (source === 'user') {
        fullEditor.updateContents(delta);
      }
    });
  </script>
</div>